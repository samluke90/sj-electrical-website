---
phase: 06-formalize-implementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - quote.html
  - js/quote-form.js
  - css/styles.css
autonomous: false

must_haves:
  truths:
    - "User can send quote request via WhatsApp with pre-filled message containing service and details"
    - "User can record voice message up to 60 seconds describing electrical issue"
    - "User sees guided diagnostic questions for Fault Finding, Rewiring, and Consumer Unit services"
    - "Contact preferences (email/phone/WhatsApp checkboxes) reach n8n webhook correctly"
    - "All form features work as expected when manually tested in Firefox"
  artifacts:
    - path: "quote.html"
      provides: "Form UI with WhatsApp button, voice recorder, symptom checker"
      contains: "voiceSection"
    - path: "js/quote-form.js"
      provides: "Form logic for all v1.2 features"
      contains: "buildWhatsAppMessage"
    - path: "css/styles.css"
      provides: "Styling for new components"
      contains: "voice-recorder"
  key_links:
    - from: "quote.html"
      to: "js/quote-form.js"
      via: "script include"
      pattern: "quote-form.js"
    - from: "js/quote-form.js"
      to: "https://wa.me/"
      via: "window.open"
      pattern: "wa\\.me"
---

<objective>
Verify existing quote form enhancements (WhatsApp handoff, voice recording, symptom checker) work correctly in Firefox, then formally commit the implementation.

Purpose: Phase 6 is a formalization phase - all features were implemented in Phase 5. This plan confirms they work as intended and commits the verified code.

Output: Verified, committed quote form with WhatsApp handoff, voice recording, and symptom checker features.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-formalize-implementation/06-CONTEXT.md
@.planning/phases/06-formalize-implementation/06-RESEARCH.md

@quote.html
@js/quote-form.js
@css/styles.css
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Manual verification of all v1.2 features in Firefox</name>
  <what-built>
    Quote form enhancements: WhatsApp handoff, voice recording (60s max with timer), and service-specific symptom checker for Fault Finding, Rewiring, and Consumer Unit services.
  </what-built>
  <how-to-verify>
    Open Firefox and navigate to quote.html. Test each requirement:

    **FORM-01 - WhatsApp Handoff:**
    1. Fill form with test data (name, phone, email, postcode, service, description)
    2. Click "Send via WhatsApp" button
    3. Verify: WhatsApp opens with pre-filled message
    4. Verify: Message contains service type and description

    **FORM-02 - Voice Recording:**
    1. Click "Record" button in Voice Message section
    2. Allow microphone permission when prompted
    3. Speak for 5-10 seconds
    4. Click "Stop" (or wait - should auto-stop at 60s)
    5. Verify: Timer counts up during recording
    6. Verify: Audio playback appears after stopping
    7. Verify: Can play back the recording
    8. Click delete button and verify: Recording is removed

    **FORM-03/04/05 - Symptom Checker:**
    1. Select "Domestic - Fault Finding" - verify diagnostic questions appear
    2. Select "Domestic - Rewiring" - verify different questions appear
    3. Select "Domestic - Consumer Unit" - verify different questions appear
    4. Select a non-diagnostic service (e.g., "EV Charger - Home") - verify questions hide
    5. Answer some questions, then submit form or use WhatsApp - verify answers included

    **FORM-06 - Contact Preferences:**
    1. Check multiple contact method checkboxes (Phone + Email + WhatsApp)
    2. Submit the form
    3. Verify: Form submits successfully (success message appears)
    4. Optional: Check n8n webhook received "Phone, Email, Text/WhatsApp" not "[object HTMLInputElement]"

    Record pass/fail for each requirement.
  </how-to-verify>
  <resume-signal>
    Type "verified" if all tests pass, or list any failures:
    - FORM-01: pass/fail
    - FORM-02: pass/fail
    - FORM-03: pass/fail
    - FORM-04: pass/fail
    - FORM-05: pass/fail
    - FORM-06: pass/fail
  </resume-signal>
</task>

<task type="auto">
  <name>Task 2: Commit verified implementation</name>
  <files>quote.html, js/quote-form.js, css/styles.css</files>
  <action>
    After user confirms all features pass verification:

    1. Stage all modified files for v1.2 features:
       ```bash
       git add quote.html js/quote-form.js css/styles.css
       ```

    2. Create atomic commit with conventional commit format:
       ```bash
       git commit -m "feat(quote): add WhatsApp handoff, voice recording, and symptom checker

       - WhatsApp button sends pre-filled message with service and details
       - Voice recording with 60s limit, timer, playback, and delete
       - Service-specific diagnostic questions for Fault Finding, Rewiring, Consumer Unit
       - Contact preferences collected as comma-separated string for n8n

       Requirements: FORM-01, FORM-02, FORM-03, FORM-04, FORM-05, FORM-06"
       ```

    3. Verify commit succeeded:
       ```bash
       git log --oneline -1
       git status
       ```
  </action>
  <verify>
    - `git log --oneline -1` shows the feat(quote) commit
    - `git status` shows clean working tree for quote.html, quote-form.js, styles.css
  </verify>
  <done>
    All v1.2 form features committed with descriptive message linking to requirements.
  </done>
</task>

</tasks>

<verification>
- [ ] All six FORM requirements verified in Firefox (happy path)
- [ ] WhatsApp message includes service and description
- [ ] Voice recording works: start, timer, stop, playback, delete
- [ ] Symptom checker shows for Fault Finding, Rewiring, Consumer Unit
- [ ] Contact preferences submit correctly
- [ ] Code committed with conventional commit message
</verification>

<success_criteria>
1. User confirms all FORM-01 through FORM-06 requirements pass manual verification
2. Git commit exists with feat(quote) message describing all three features
3. Working tree is clean for the modified files
</success_criteria>

<output>
After completion, create `.planning/phases/06-formalize-implementation/06-01-SUMMARY.md`
</output>
